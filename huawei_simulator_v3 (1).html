<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åä¸ºæ‰“å·¥æ¨¡æ‹Ÿå™¨ v3.0 ğŸ¢</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .game-container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            max-width: 1000px;
            margin: 0 auto;
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #e60012, #c50011);
            color: white;
            padding: 30px;
            text-align: center;
            position: relative;
        }

        .version {
            position: absolute;
            top: 10px;
            right: 15px;
            font-size: 12px;
            opacity: 0.8;
        }

        .header h1 {
            font-size: 32px;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 14px;
        }

        .tabs {
            display: flex;
            background: #f0f0f0;
            border-bottom: 2px solid #e60012;
        }

        .tab {
            flex: 1;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            background: #f0f0f0;
            border: none;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
        }

        .tab:hover {
            background: #e0e0e0;
        }

        .tab.active {
            background: white;
            color: #e60012;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .player-info {
            background: #f8f9fa;
            padding: 25px;
            border-bottom: 3px solid #e60012;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            flex-wrap: wrap;
            gap: 10px;
        }

        .info-item {
            background: white;
            padding: 12px 20px;
            border-radius: 12px;
            flex: 1;
            min-width: 140px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .info-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
        }

        .info-value {
            font-size: 18px;
            font-weight: bold;
            color: #e60012;
        }

        .info-value.small {
            font-size: 14px;
        }

        .progress-bar {
            background: #e0e0e0;
            height: 25px;
            border-radius: 12px;
            overflow: hidden;
            margin: 15px 0;
            position: relative;
        }

        .progress-fill {
            background: linear-gradient(90deg, #e60012, #ff3333);
            height: 100%;
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            font-weight: bold;
        }

        .actions {
            padding: 25px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
        }

        .btn {
            padding: 15px 20px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }

        .btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.15);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-primary { background: #e60012; color: white; }
        .btn-secondary { background: #4CAF50; color: white; }
        .btn-warning { background: #ff9800; color: white; }
        .btn-info { background: #2196F3; color: white; }
        .btn-purple { background: #9C27B0; color: white; }
        .btn-dark { background: #333; color: white; }

        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn small {
            display: block;
            font-size: 12px;
            opacity: 0.9;
            margin-top: 3px;
        }

        .card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 15px;
            border-left: 4px solid #e60012;
            cursor: pointer;
            transition: all 0.3s;
        }

        .card:hover {
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transform: translateX(5px);
        }

        .card-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }

        .card-subtitle {
            color: #666;
            font-size: 14px;
            margin-bottom: 8px;
        }

        .card-reward {
            color: #4CAF50;
            font-size: 14px;
            margin: 5px 0;
        }

        .card-price {
            color: #e60012;
            font-size: 14px;
            font-weight: bold;
        }

        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 40px;
            border-radius: 20px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            animation: slideDown 0.3s ease;
            max-height: 80vh;
            overflow-y: auto;
        }

        @keyframes slideDown {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-icon {
            font-size: 64px;
            margin-bottom: 20px;
        }

        .modal-title {
            font-size: 24px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
        }

        .modal-description {
            font-size: 16px;
            color: #666;
            margin-bottom: 25px;
            line-height: 1.6;
        }

        .modal-buttons {
            display: flex;
            gap: 10px;
            justify-content: center;
        }

        .section-title {
            font-size: 20px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
            padding-left: 15px;
            border-left: 4px solid #e60012;
        }

        .stat-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            padding: 20px;
        }

        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 12px;
            text-align: center;
        }

        .stat-card-value {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .stat-card-label {
            font-size: 14px;
            opacity: 0.9;
        }

        .leaderboard-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px;
            background: white;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid #e60012;
        }

        .leaderboard-rank {
            font-size: 24px;
            font-weight: bold;
            color: #e60012;
            min-width: 40px;
        }

        .leaderboard-name {
            flex: 1;
            margin-left: 15px;
        }

        .leaderboard-score {
            font-weight: bold;
            color: #4CAF50;
        }

        .qte-game {
            text-align: center;
            padding: 20px;
        }

        .qte-button {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            font-size: 48px;
            border: none;
            cursor: pointer;
            margin: 10px;
            transition: all 0.2s;
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .qte-button:active {
            transform: scale(0.9);
        }

        .qte-timer {
            font-size: 24px;
            font-weight: bold;
            margin: 20px 0;
            color: #e60012;
        }

        .stock-chart {
            height: 200px;
            background: #f0f0f0;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            position: relative;
            overflow: hidden;
        }

        .stock-line {
            position: absolute;
            bottom: 20px;
            left: 20px;
            right: 20px;
            height: 2px;
            background: #e60012;
        }

        .achievement-badge {
            display: inline-block;
            background: linear-gradient(135deg, #FFD700, #FFA500);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            margin: 5px;
        }

        .choice-btn {
            width: 100%;
            padding: 15px;
            margin: 10px 0;
            text-align: left;
            background: #f8f9fa;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .choice-btn:hover {
            background: #e60012;
            color: white;
            border-color: #e60012;
        }

        .property-owned {
            background: #4CAF50;
            color: white;
            padding: 3px 8px;
            border-radius: 5px;
            font-size: 11px;
            margin-left: 10px;
        }

        @media (max-width: 768px) {
            .info-row { flex-direction: column; }
            .actions { grid-template-columns: 1fr 1fr; }
            .modal-content { padding: 20px; }
        }
    </style>
</head>
<body>
    <div class="game-container">
        <!-- å¤´éƒ¨ -->
        <div class="header">
            <div class="version">v3.0 å®Œæ•´ç‰ˆ</div>
            <h1 ondblclick="resetGame()">ğŸ¢ åä¸ºæ‰“å·¥æ¨¡æ‹Ÿå™¨</h1>
            <p>ä»åº”å±Šç”Ÿåˆ°æ€»è£çš„å¥‹æ–—ä¹‹è·¯ | åŒå‡»æ ‡é¢˜é‡ç½®æ¸¸æˆ</p>
        </div>

        <!-- æ ‡ç­¾é¡µ -->
        <div class="tabs">
            <button class="tab active" onclick="switchTab('main')">ğŸ  ä¸»ç•Œé¢</button>
            <button class="tab" onclick="switchTab('career')">ğŸ’¼ èŒä¸š</button>
            <button class="tab" onclick="switchTab('life')">ğŸ¡ ç”Ÿæ´»</button>
            <button class="tab" onclick="switchTab('stats')">ğŸ“Š ç»Ÿè®¡</button>
        </div>

        <!-- ä¸»ç•Œé¢ -->
        <div id="main-tab" class="tab-content active">
            <div class="player-info">
                <div class="info-row">
                    <div class="info-item">
                        <div class="info-label">ğŸ‘¤ å§“å</div>
                        <div class="info-value small" id="player-name">åŠ è½½ä¸­...</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">ğŸ¯ èŒçº§</div>
                        <div class="info-value" id="level">13çº§ å·¥ç¨‹å¸ˆ</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">ğŸ“ˆ é€šé“</div>
                        <div class="info-value small" id="career-path">æŠ€æœ¯é€šé“</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">ğŸ’° å¹´è–ª</div>
                        <div class="info-value" id="salary">Â¥220,000</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">ğŸ“Š ç»©æ•ˆ</div>
                        <div class="info-value" id="performance">B+</div>
                    </div>
                </div>

                <div class="info-row">
                    <div class="info-item">
                        <div class="info-label">ğŸ’ åä¸ºè‚¡</div>
                        <div class="info-value" id="stock">0 è‚¡</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">ğŸ’µ è‚¡ç¥¨ä»·å€¼</div>
                        <div class="info-value" id="stock-value">Â¥0</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">ğŸ¦ å­˜æ¬¾</div>
                        <div class="info-value" id="money">Â¥0</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">ğŸ“… å·¥é¾„</div>
                        <div class="info-value" id="days">0 å¤©</div>
                    </div>
                </div>

                <div class="info-label">ğŸ¯ KPIè¿›åº¦</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="kpi-progress">0 / 1000</div>
                </div>

                <div class="info-label">â° è·ç¦»å¹´åº¦è€ƒæ ¸</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="year-progress" style="background: linear-gradient(90deg, #4CAF50, #66BB6A);">365 å¤©</div>
                </div>
            </div>

            <div class="actions">
                <button class="btn btn-primary" onclick="writeCode()">ğŸ’» å†™ä»£ç <br><small>+10 KPI</small></button>
                <button class="btn btn-secondary" onclick="meeting()">ğŸ—£ï¸ å¼€ä¼š<br><small>+5 KPI</small></button>
                <button class="btn btn-warning" onclick="study()">ğŸ“š å­¦ä¹ <br><small>æå‡èƒ½åŠ›</small></button>
                <button class="btn btn-info" onclick="showProjects()">ğŸ“‹ åšé¡¹ç›®<br><small>å¤§é‡KPI</small></button>
                <button class="btn btn-purple" onclick="applyPatent()">ğŸ“œ ç”³è¯·ä¸“åˆ©<br><small id="patent-cost">Â¥20,000</small></button>
                <button class="btn btn-dark" onclick="showOverseas()">ğŸŒ æµ·å¤–æ´¾é£<br><small>é«˜é£é™©é«˜å›æŠ¥</small></button>
            </div>
        </div>

        <!-- èŒä¸šæ ‡ç­¾é¡µ -->
        <div id="career-tab" class="tab-content">
            <div style="padding: 25px;">
                <h3 class="section-title">ğŸ’¼ èŒä¸šå‘å±•</h3>
                
                <div class="card" onclick="switchCareerPath()">
                    <div class="card-title">ğŸ”€ åˆ‡æ¢èŒä¸šé€šé“</div>
                    <div class="card-subtitle">å½“å‰: <span id="current-path">æŠ€æœ¯é€šé“</span></div>
                    <div class="card-reward" id="switch-requirement">15çº§ä»¥ä¸Šå¯åˆ‡æ¢åˆ°ç®¡ç†é€šé“</div>
                </div>

                <div class="card" onclick="showPromotionReview()">
                    <div class="card-title">ğŸ¤ è¿°èŒç­”è¾©</div>
                    <div class="card-subtitle">å‘è¯„å§”ä¼šå±•ç¤ºæˆæœï¼Œäº‰å–æ™‹å‡</div>
                    <div class="card-reward">éœ€è¦: KPIè¾¾æ ‡ + é€šè¿‡ç­”è¾©</div>
                </div>

                <div class="card" onclick="showJobHopping()">
                    <div class="card-title">ğŸ’¼ è·³æ§½æœºä¼š</div>
                    <div class="card-subtitle">æ”¶åˆ°å…¶ä»–å…¬å¸çš„offer</div>
                    <div class="card-reward" id="job-offers">æš‚æ— offer</div>
                </div>

                <h3 class="section-title" style="margin-top: 30px;">ğŸ“œ ä¸“åˆ©åˆ—è¡¨</h3>
                <div id="patent-list">
                    <div style="color: #999; text-align: center; padding: 20px;">
                        è¿˜æ²¡æœ‰ä¸“åˆ©ï¼Œå¿«å»ç”³è¯·å§ï¼
                    </div>
                </div>
            </div>
        </div>

        <!-- ç”Ÿæ´»æ ‡ç­¾é¡µ -->
        <div id="life-tab" class="tab-content">
            <div style="padding: 25px;">
                <h3 class="section-title">ğŸ¡ ç”Ÿæ´»ä¸èµ„äº§</h3>

                <div class="info-row" style="margin-bottom: 25px;">
                    <div class="info-item">
                        <div class="info-label">ğŸ’‘ å©šå§»çŠ¶æ€</div>
                        <div class="info-value small" id="marriage-status">å•èº«</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">ğŸ  æˆ¿äº§</div>
                        <div class="info-value small" id="house-status">æ— æˆ¿äº§</div>
                    </div>
                    <div class="info-item">
                        <div class="info-label">ğŸš— è½¦è¾†</div>
                        <div class="info-value small" id="car-status">æ— è½¦</div>
                    </div>
                </div>

                <h3 class="section-title">ğŸ¡ ç”Ÿæ´»ä¸èµ„äº§</h3>
                
                <div class="card" onclick="buyHouse('shenzhenwan')">
                    <div class="card-title">ğŸŒŸ æ·±åœ³æ¹¾è±ªå®…å¤§å¹³å±‚ <span id="shenzhenwan-owned"></span></div>
                    <div class="card-subtitle">200ã¡ æµ·æ™¯è±ªè£… | é¡¶çº§å¯ŒäººåŒº | ä¿¯ç°æ·±åœ³æ¹¾</div>
                    <div class="card-price">å”®ä»·: Â¥25,000,000 | æ¯æœˆæˆ¿è´·: -Â¥78,000</div>
                    <div class="card-reward">å¢å€¼æ½œåŠ›: â­â­â­â­â­â­ | èº«ä»½è±¡å¾: Fellowçº§åˆ«ä¸“å± | é€šå‹¤: 15åˆ†é’Ÿ</div>
                </div>

                <div class="card" onclick="buyHouse('shenzhen')">
                    <div class="card-title">æ·±åœ³å—å±±åŒº <span id="shenzhen-owned"></span></div>
                    <div class="card-subtitle">80ã¡ ç²¾è£…ä¸¤æˆ¿ | é è¿‘åä¸ºæ€»éƒ¨</div>
                    <div class="card-price">å”®ä»·: Â¥8,000,000 | æ¯æœˆæˆ¿è´·: -Â¥25,000</div>
                    <div class="card-reward">å¢å€¼æ½œåŠ›: â­â­â­â­â­ | é€šå‹¤æ—¶é—´: 20åˆ†é’Ÿ</div>
                </div>

                <div class="card" onclick="buyHouse('dongguan')">
                    <div class="card-title">ä¸œèæ¾å±±æ¹– <span id="dongguan-owned"></span></div>
                    <div class="card-subtitle">100ã¡ ç²¾è£…ä¸‰æˆ¿ | é è¿‘åä¸ºç ”å‘ä¸­å¿ƒ</div>
                    <div class="card-price">å”®ä»·: Â¥3,000,000 | æ¯æœˆæˆ¿è´·: -Â¥9,500</div>
                    <div class="card-reward">å¢å€¼æ½œåŠ›: â­â­â­â­ | é€šå‹¤æ—¶é—´: 30åˆ†é’Ÿ</div>
                </div>

                <div class="card" onclick="buyHouse('hometown')">
                    <div class="card-title">è€å®¶å¿åŸ <span id="hometown-owned"></span></div>
                    <div class="card-subtitle">120ã¡ ä¸‰æˆ¿ | çˆ¶æ¯å…»è€</div>
                    <div class="card-price">å”®ä»·: Â¥500,000 | å…¨æ¬¾æ— å‹åŠ›</div>
                    <div class="card-reward">å¢å€¼æ½œåŠ›: â­â­ | å­å¿ƒ: â­â­â­â­â­</div>
                </div>

                <h3 class="section-title" style="margin-top: 30px;">ğŸš— è´­è½¦é€‰æ‹©</h3>
                
                <div class="card" onclick="buyCar('porsche')">
                    <div class="card-title">ğŸï¸ ä¿æ—¶æ·911 <span id="porsche-owned"></span></div>
                    <div class="card-subtitle">ç»å…¸è·‘è½¦ | èº«ä»½è±¡å¾ | 0-100km/h 3.0s</div>
                    <div class="card-price">å”®ä»·: Â¥1,500,000 | å½°æ˜¾æˆåŠŸ</div>
                    <div class="card-reward">éœ€è¦: 16çº§ä»¥ä¸Š | ç‚«é…·æŒ‡æ•°: â­â­â­â­â­</div>
                </div>

                <div class="card" onclick="buyCar('wenjie')">
                    <div class="card-title">ğŸš™ åä¸ºé—®ç•ŒM9 <span id="wenjie-owned"></span></div>
                    <div class="card-subtitle">åä¸ºæ™ºé€‰è½¦ | é¸¿è’™åº§èˆ± | æ™ºèƒ½é©¾é©¶</div>
                    <div class="card-price">å”®ä»·: Â¥500,000 | å‘˜å·¥ä¼˜æƒ ä»·</div>
                    <div class="card-reward">åä¸ºå‘˜å·¥ç‰¹ä¾› | æ™ºèƒ½åŒ–: â­â­â­â­â­ | å¯è·å†…éƒ¨æŠ˜æ‰£</div>
                </div>

                <div class="card" onclick="buyCar('aito')">
                    <div class="card-title">ğŸš— AITOé—®ç•ŒM7 <span id="aito-owned"></span></div>
                    <div class="card-subtitle">åä¸ºæ™ºé€‰ | æ€§ä»·æ¯”ä¹‹é€‰</div>
                    <div class="card-price">å”®ä»·: Â¥300,000 | å®æƒ ä¹‹é€‰</div>
                    <div class="card-reward">æ–°äººæ¨è | æ€§ä»·æ¯”: â­â­â­â­â­</div>
                </div>

                <h3 class="section-title" style="margin-top: 30px;">ğŸ’‘ å©šå§»å¤§äº‹</h3>
                
                <div class="card" onclick="findPartner('internal')">
                    <div class="card-title">åä¸ºå†…éƒ¨å¾å©š</div>
                    <div class="card-subtitle">æ‰¾åŒäº‹åšä¼´ä¾£ï¼Œå…±åŒå¥‹æ–—</div>
                    <div class="card-reward">ä¼˜ç‚¹: ç†è§£å·¥ä½œ +10%å·¥ä½œæ•ˆç‡ | å¯èƒ½è·å¾—åŒèŒå·¥ç¦åˆ©</div>
                </div>

                <div class="card" onclick="findPartner('external')">
                    <div class="card-title">å¤–éƒ¨æ‹çˆ±</div>
                    <div class="card-subtitle">åœ¨å¤–é¢æ‰¾å¯¹è±¡</div>
                    <div class="card-reward">ä¼˜ç‚¹: ç”Ÿæ´»å¹³è¡¡ | ç¼ºç‚¹: å¯èƒ½ä¸ç†è§£åŠ ç­</div>
                </div>
            </div>
        </div>

        <!-- ç»Ÿè®¡æ ‡ç­¾é¡µ -->
        <div id="stats-tab" class="tab-content">
            <div class="stat-grid">
                <div class="stat-card">
                    <div class="stat-card-value" id="stat-total-kpi">0</div>
                    <div class="stat-card-label">ç´¯è®¡KPI</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-value" id="stat-total-projects">0</div>
                    <div class="stat-card-label">å®Œæˆé¡¹ç›®</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-value" id="stat-total-patents">0</div>
                    <div class="stat-card-label">ä¸“åˆ©æ•°é‡</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-value" id="stat-promotions">0</div>
                    <div class="stat-card-label">æ™‹å‡æ¬¡æ•°</div>
                </div>
            </div>

            <div style="padding: 25px;">
                <h3 class="section-title">ğŸ† æˆå°±ç³»ç»Ÿ</h3>
                <div id="achievement-list">
                    <div style="color: #999; text-align: center; padding: 20px;">
                        åŠªåŠ›å·¥ä½œï¼Œè§£é”æˆå°±ï¼
                    </div>
                </div>

                <h3 class="section-title" style="margin-top: 30px;">ğŸ“Š å…¨æœæ’è¡Œæ¦œ</h3>
                <div id="leaderboard">
                    <div class="leaderboard-item">
                        <div class="leaderboard-rank">1</div>
                        <div class="leaderboard-name">
                            <div style="font-weight: bold;">å¼ ä¸‰</div>
                            <div style="font-size: 12px; color: #666;">20çº§ Fellow</div>
                        </div>
                        <div class="leaderboard-score">å·¥é¾„: 3650å¤©</div>
                    </div>
                    <div class="leaderboard-item">
                        <div class="leaderboard-rank">2</div>
                        <div class="leaderboard-name">
                            <div style="font-weight: bold;">æå››</div>
                            <div style="font-size: 12px; color: #666;">19çº§ é¦–å¸­ç§‘å­¦å®¶</div>
                        </div>
                        <div class="leaderboard-score">å·¥é¾„: 3200å¤©</div>
                    </div>
                    <div class="leaderboard-item">
                        <div class="leaderboard-rank">3</div>
                        <div class="leaderboard-name">
                            <div style="font-weight: bold;">ç‹äº”</div>
                            <div style="font-size: 12px; color: #666;">18çº§ é¡¶çº§ä¸“å®¶</div>
                        </div>
                        <div class="leaderboard-score">å·¥é¾„: 2800å¤©</div>
                    </div>
                    <div class="leaderboard-item" style="border-color: #4CAF50;">
                        <div class="leaderboard-rank" style="color: #4CAF50;">...</div>
                        <div class="leaderboard-name">
                            <div style="font-weight: bold;">ä½ </div>
                            <div style="font-size: 12px; color: #666;" id="your-rank-info">13çº§ å·¥ç¨‹å¸ˆ</div>
                        </div>
                        <div class="leaderboard-score" id="your-rank-days">å·¥é¾„: 0å¤©</div>
                    </div>
                </div>

                <h3 class="section-title" style="margin-top: 30px;">ğŸ“ˆ åä¸ºè‚¡ç¥¨èµ°åŠ¿</h3>
                <div class="stock-chart">
                    <canvas id="stock-canvas" width="600" height="160"></canvas>
                </div>
                <div style="text-align: center; margin-top: 10px;">
                    <div>å½“å‰è‚¡ä»·: <span id="current-stock-price" style="font-size: 24px; font-weight: bold; color: #e60012;">Â¥100</span></div>
                    <div style="margin: 15px 0; color: #666; font-size: 14px;">
                        æŒæœ‰: <span id="stock-amount" style="font-weight: bold; color: #e60012;">0</span>ä¸‡è‚¡ 
                        | æ€»å€¼: <span id="total-stock-value" style="font-weight: bold; color: #4CAF50;">Â¥0</span>
                    </div>
                    <button class="btn btn-primary" onclick="buyStock()" style="margin-top: 10px;">ä¹°å…¥ 1ä¸‡è‚¡ (<span id="buy-cost">Â¥100ä¸‡</span>)</button>
                    <button class="btn btn-secondary" onclick="sellStock()" style="margin-top: 10px;">å–å‡º 1ä¸‡è‚¡</button>
                </div>
            </div>
        </div>

        <!-- æ¨¡æ€æ¡† -->
        <div id="modal" class="modal">
            <div class="modal-content">
                <div class="modal-icon" id="modal-icon">ğŸ‰</div>
                <div class="modal-title" id="modal-title">æ ‡é¢˜</div>
                <div class="modal-description" id="modal-description">æè¿°</div>
                <div class="modal-buttons" id="modal-buttons">
                    <button class="btn btn-primary" onclick="closeModal()">ç¡®å®š</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        // ==================== æ¸¸æˆæ•°æ® ====================
        let gameData = {
            // åŸºç¡€å±æ€§
            playerName: '',
            level: 13,
            levelName: 'å·¥ç¨‹å¸ˆ',
            careerPath: 'tech', // tech or management
            salary: 220000,
            performance: 'B+',
            kpi: 0,
            kpiTarget: 1000,
            stock: 0, // æ”¹ä¸ºä¸‡è‚¡ä¸ºå•ä½
            stockPrice: 100,
            stockHistory: [100],
            money: 0,
            days: 0,
            daysUntilReview: 365,
            
            // æŠ€èƒ½
            skills: {
                coding: 1,
                communication: 1,
                management: 0,
                patents: 0
            },
            
            // ç”Ÿæ´»
            married: false,
            marriageType: null, // internal or external
            houses: {
                shenzhenwan: false,
                shenzhen: false,
                dongguan: false,
                hometown: false
            },
            cars: {
                porsche: false,
                wenjie: false,
                aito: false
            },
            
            // ç»Ÿè®¡
            stats: {
                totalKPI: 0,
                totalProjects: 0,
                totalPatents: 0,
                promotions: 0,
                overseasDays: 0
            },
            
            // å…¶ä»–
            patents: [],
            achievements: [],
            currentProject: null,
            overseasLocation: null
        };

        // è°éŸ³æ¢—å§“ååº“
        const FUNNY_NAMES = [
            'éƒè‹‘å·¥', // å¥½å‘˜å·¥
            'è´å›½éœ', // è¢«è£æ‰
            'éœè½¦å¤´', // ç«è½¦å¤´
            'ç¨‹ç»­çŒ¿', // ç¨‹åºå‘˜
            'ç”˜åŠ ç­', // æ•¢åŠ ç­
            'å²å¤§ä½¬', // æ˜¯å¤§ä½¬
            'ç‰›æ¯”å“„', // ç‰›é€¼å“„
            'é™†ç»­æ¶¨', // é™†ç»­æ¶¨
            'æ›¹ä½œè€…', // æ“ä½œè€…
            'èŒƒç»Ÿç­¹', // é¥­æ¡¶æ„
            'å°¤å‡å€¼', // æœ‰å‡èŒ
            'é«˜ç‘å', // é«˜è–ªå
            'å¸æ­èµ„', // æ€å·¥èµ„
            'ä¸¥å¤§ç‰›', // ç ”å¤§ç‰›
            'é’Ÿç‚¹å·¥', // é’Ÿç‚¹å·¥
            'å“è·ƒå…ˆ', // å“è¶Šé²œ
            'ç§¦å¥‹æ–—', // å‹¤å¥‹æ–—
            'èµ–åŠ ç­', // æ¥åŠ ç­
            'è®¸åŠ è–ª', // éœ€åŠ è–ª
            'é©¬ä¸åœ', // é©¬ä¸åœ
        ];

        // èŒçº§é…ç½®
        const LEVELS = {
            tech: {
                13: { name: 'å·¥ç¨‹å¸ˆ', salary: 220000, kpiTarget: 1000 },
                14: { name: 'èµ„æ·±å·¥ç¨‹å¸ˆ', salary: 280000, kpiTarget: 1500 },
                15: { name: 'é«˜çº§å·¥ç¨‹å¸ˆ', salary: 380000, kpiTarget: 2000 },
                16: { name: 'èµ„æ·±ä¸“å®¶', salary: 550000, kpiTarget: 3000 },
                17: { name: 'é«˜çº§ä¸“å®¶', salary: 850000, kpiTarget: 5000 },
                18: { name: 'é¡¶çº§ä¸“å®¶', salary: 1500000, kpiTarget: 8000 },
                19: { name: 'é¦–å¸­ç§‘å­¦å®¶', salary: 3000000, kpiTarget: 15000 },
                20: { name: 'Fellow', salary: 5000000, kpiTarget: 30000 }
            },
            management: {
                15: { name: 'ä¸»ç®¡', salary: 400000, kpiTarget: 2000 },
                16: { name: 'ç»ç†', salary: 600000, kpiTarget: 3000 },
                17: { name: 'éƒ¨é—¨æ€»ç›‘', salary: 1000000, kpiTarget: 5000 },
                18: { name: 'å‰¯æ€»è£', salary: 2000000, kpiTarget: 8000 },
                19: { name: 'é«˜çº§å‰¯æ€»è£', salary: 4000000, kpiTarget: 15000 },
                20: { name: 'æ€»è£', salary: 8000000, kpiTarget: 30000 },
                22: { name: 'CEO', salary: 20000000, kpiTarget: 50000 }
            }
        };

        // æ‰©å±•çš„éšæœºäº‹ä»¶åº“
        const EVENTS = [
            { icon: 'ğŸ‰', title: 'é¡¹ç›®è·å®¢æˆ·è®¤å¯', desc: 'KPI +100', effect: () => { gameData.kpi += 100; } },
            { icon: 'ğŸ“œ', title: 'ä¸“åˆ©ç”³è¯·æˆåŠŸ', desc: 'Â¥50,000å¥–é‡‘', effect: () => { gameData.money += 50000; addPatent('ä¸´æ—¶ä¸“åˆ©'); } },
            { icon: 'ğŸ˜°', title: 'é¡¹ç›®å»¶æœŸè¢«æ‰¹è¯„', desc: 'KPI -50', effect: () => { gameData.kpi = Math.max(0, gameData.kpi - 50); } },
            { icon: 'ğŸ–ï¸', title: 'æ˜æ—¥ä¹‹æ˜Ÿè®¡åˆ’', desc: 'KPI +200', effect: () => { gameData.kpi += 200; addAchievement('æ˜æ—¥ä¹‹æ˜Ÿ'); } },
            { icon: 'ğŸ’°', title: 'å…¬å¸åˆ†çº¢åˆ°è´¦', desc: 'éšæœºé‡‘é¢', effect: () => { const bonus = Math.floor(Math.random() * 100000 + 50000); gameData.money += bonus; showModal('ğŸ’°', 'åˆ†çº¢åˆ°è´¦', `æ”¶åˆ°åˆ†çº¢: Â¥${bonus.toLocaleString()}`); } },
            { icon: 'ğŸ”¥', title: 'ç«äº‰å¯¹æ‰‹æŒ–è§’', desc: 'å›¢é˜Ÿä¸ç¨³', effect: () => { showModal('ğŸ”¥', 'ç«äº‰å¯¹æ‰‹æŒ–è§’', 'å›¢é˜Ÿæœ‰äººç¦»èŒï¼Œé¡¹ç›®è¿›åº¦å—å½±å“'); } },
            { icon: 'ğŸ†', title: 'è·å¾—å…¬å¸å˜‰å¥–', desc: 'KPI +150', effect: () => { gameData.kpi += 150; addAchievement('è·å¾—å˜‰å¥–'); } },
            { icon: 'ğŸ“±', title: 'æ–°äº§å“å‘å¸ƒæˆåŠŸ', desc: 'KPI +300', effect: () => { gameData.kpi += 300; } },
            { icon: 'ğŸŒŸ', title: 'æŠ€æœ¯çªç ´', desc: 'ä¸“åˆ©+èƒ½åŠ›æå‡', effect: () => { gameData.skills.coding += 1; addPatent('æŠ€æœ¯çªç ´ä¸“åˆ©'); } },
            { icon: 'ğŸ˜«', title: 'è¿ç»­åŠ ç­ä¸€å‘¨', desc: 'ç–²åŠ³åº¦ä¸Šå‡', effect: () => { showModal('ğŸ˜«', 'å¤ªç´¯äº†', 'è¿ç»­åŠ ç­ï¼Œå»ºè®®æ³¨æ„ä¼‘æ¯'); } },
            { icon: 'ğŸ', title: 'è‚¡ç¥¨å¥–åŠ±', desc: '+10è‚¡', effect: () => { gameData.stock += 10; showModal('ğŸ', 'è‚¡ç¥¨å¥–åŠ±', 'è·å¾—10è‚¡åä¸ºè‚¡ç¥¨ï¼'); } },
            { icon: 'ğŸ“Š', title: 'å­£åº¦è€ƒæ ¸ä¼˜ç§€', desc: 'KPI +80', effect: () => { gameData.kpi += 80; } },
            { icon: 'ğŸš€', title: 'é¡¹ç›®æå‰å®Œæˆ', desc: 'KPI +200 + Â¥30,000', effect: () => { gameData.kpi += 200; gameData.money += 30000; } },
            { icon: 'ğŸ’¡', title: 'åˆ›æ–°ææ¡ˆè¢«é‡‡çº³', desc: 'KPI +120', effect: () => { gameData.kpi += 120; } },
            { icon: 'ğŸŒ', title: 'å›½é™…ä¼šè®®å‘è¡¨è®ºæ–‡', desc: 'å£°æœ›å¤§å¢', effect: () => { gameData.kpi += 150; addAchievement('å›½é™…å½±å“åŠ›'); } }
        ];

        // ==================== åˆå§‹åŒ– ====================
        function init() {
            loadGame();
            
            // å¦‚æœæ˜¯æ–°æ¸¸æˆï¼Œéšæœºç”Ÿæˆå§“å
            if (!gameData.playerName) {
                gameData.playerName = FUNNY_NAMES[Math.floor(Math.random() * FUNNY_NAMES.length)];
                saveGame();
            }
            
            updateUI();
            drawStockChart();
            setInterval(updateStock, 5000); // æ¯5ç§’æ›´æ–°è‚¡ä»·
        }

        // ==================== æ ¸å¿ƒåŠŸèƒ½ ====================
        function writeCode() {
            gameData.kpi += 10;
            gameData.skills.coding += 0.1;
            gameData.stats.totalKPI += 10;
            advanceDay(1);
            checkRandomEvent(0.1);
            updateUI();
            saveGame();
        }

        function meeting() {
            gameData.kpi += 5;
            gameData.skills.communication += 0.1;
            gameData.stats.totalKPI += 5;
            advanceDay(0.5);
            checkRandomEvent(0.15);
            updateUI();
            saveGame();
        }

        function study() {
            const skills = ['coding', 'communication', 'management'];
            const randomSkill = skills[Math.floor(Math.random() * skills.length)];
            gameData.skills[randomSkill] += 0.5;
            advanceDay(1);
            showModal('ğŸ“š', 'æŠ€èƒ½æå‡', `${randomSkill} +0.5`);
            updateUI();
            saveGame();
        }

        function showProjects() {
            const projects = [
                { name: 'åŸºç«™ä¼˜åŒ–', days: 30, kpi: 150, money: 5000, promote: 0 },
                { name: '5Gæ ‡å‡†åˆ¶å®š', days: 90, kpi: 400, money: 20000, promote: 0.3 },
                { name: 'é¸¿è’™OSå¼€å‘', days: 180, kpi: 1000, money: 100000, promote: 0.7 }
            ];
            
            let html = '<div class="modal-title">é€‰æ‹©é¡¹ç›®</div>';
            projects.forEach((p, i) => {
                html += `
                    <div class="choice-btn" onclick="startProject(${i})">
                        <div style="font-weight: bold; margin-bottom: 5px;">${p.name}</div>
                        <div style="font-size: 12px; color: #666;">
                            æ—¶é•¿: ${p.days}å¤© | KPI: +${p.kpi} | å¥–é‡‘: Â¥${p.money.toLocaleString()}
                            ${p.promote > 0 ? ` | æ™‹å‡æ¦‚ç‡: ${p.promote * 100}%` : ''}
                        </div>
                    </div>
                `;
            });
            
            document.getElementById('modal-description').innerHTML = html;
            document.getElementById('modal-icon').textContent = 'ğŸ“‹';
            document.getElementById('modal-buttons').innerHTML = '<button class="btn btn-secondary" onclick="closeModal()">å–æ¶ˆ</button>';
            showModalRaw();
        }

        function startProject(index) {
            const projects = [
                { name: 'åŸºç«™ä¼˜åŒ–', days: 30, kpi: 150, money: 5000, promote: 0 },
                { name: '5Gæ ‡å‡†åˆ¶å®š', days: 90, kpi: 400, money: 20000, promote: 0.3 },
                { name: 'é¸¿è’™OSå¼€å‘', days: 180, kpi: 1000, money: 100000, promote: 0.7 }
            ];
            
            const project = projects[index];
            closeModal();
            
            advanceDay(project.days);
            gameData.kpi += project.kpi;
            gameData.money += project.money;
            gameData.stats.totalKPI += project.kpi;
            gameData.stats.totalProjects++;
            
            let message = `è·å¾— +${project.kpi} KPI, +Â¥${project.money.toLocaleString()}`;
            
            if (project.promote > 0 && Math.random() < project.promote) {
                promote();
                message += '\n\næ­å–œæ™‹å‡ï¼';
            }
            
            showModal('ğŸ‰', project.name + ' å®Œæˆ', message);
            updateUI();
            saveGame();
        }

        // ==================== ä¸“åˆ©ç³»ç»Ÿ ====================
        function applyPatent() {
            const cost = 20000 + gameData.stats.totalPatents * 5000;
            
            if (gameData.money < cost) {
                showModal('âŒ', 'ä½™é¢ä¸è¶³', `ç”³è¯·ä¸“åˆ©éœ€è¦ Â¥${cost.toLocaleString()}`);
                return;
            }
            
            gameData.money -= cost;
            advanceDay(30);
            
            if (Math.random() < 0.7 + gameData.skills.coding * 0.05) {
                const patentName = `ä¸“åˆ©#${gameData.patents.length + 1}`;
                addPatent(patentName);
                gameData.kpi += 200;
                gameData.stats.totalKPI += 200;
                showModal('ğŸ“œ', 'ä¸“åˆ©ç”³è¯·æˆåŠŸï¼', `è·å¾—ä¸“åˆ©: ${patentName}\nKPI +200`);
            } else {
                showModal('ğŸ˜”', 'ä¸“åˆ©ç”³è¯·å¤±è´¥', 'å¾ˆé—æ†¾ï¼Œæœ¬æ¬¡ç”³è¯·æœªé€šè¿‡å®¡æ ¸');
            }
            
            updateUI();
            saveGame();
        }

        function addPatent(name) {
            gameData.patents.push({
                name: name,
                date: gameData.days
            });
            gameData.skills.patents++;
            gameData.stats.totalPatents++;
            updatePatentList();
        }

        function updatePatentList() {
            const list = document.getElementById('patent-list');
            if (gameData.patents.length === 0) {
                list.innerHTML = '<div style="color: #999; text-align: center; padding: 20px;">è¿˜æ²¡æœ‰ä¸“åˆ©ï¼Œå¿«å»ç”³è¯·å§ï¼</div>';
            } else {
                list.innerHTML = gameData.patents.map((p, i) => 
                    `<div class="card">
                        <div class="card-title">ğŸ“œ ${p.name}</div>
                        <div class="card-subtitle">ç”³è¯·æ—¥æœŸ: ç¬¬${p.date}å¤©</div>
                    </div>`
                ).join('');
            }
        }

        // ==================== æµ·å¤–æ´¾é£ ====================
        function showOverseas() {
            const locations = [
                { name: 'éæ´²è‚¯å°¼äºš', bonus: 1.5, risk: 0.3, duration: 365 },
                { name: 'ä¸­ä¸œæ²™ç‰¹', bonus: 1.8, risk: 0.2, duration: 180 },
                { name: 'æ‹‰ç¾å·´è¥¿', bonus: 1.3, risk: 0.1, duration: 270 }
            ];
            
            let html = '<div class="modal-title">æµ·å¤–æ´¾é£æœºä¼š</div>';
            locations.forEach((loc, i) => {
                html += `
                    <div class="choice-btn" onclick="goOverseas(${i})">
                        <div style="font-weight: bold; margin-bottom: 5px;">ğŸŒ ${loc.name}</div>
                        <div style="font-size: 12px; color: #666;">
                            æ—¶é•¿: ${loc.duration}å¤© | è–ªèµ„: ${loc.bonus}x | é£é™©: ${loc.risk * 100}%
                        </div>
                        <div style="font-size: 12px; color: #4CAF50; margin-top: 3px;">
                            æ™‹å‡åŠ é€Ÿ + è‰°è‹¦è¡¥è´´
                        </div>
                    </div>
                `;
            });
            
            document.getElementById('modal-description').innerHTML = html;
            document.getElementById('modal-icon').textContent = 'ğŸŒ';
            document.getElementById('modal-buttons').innerHTML = '<button class="btn btn-secondary" onclick="closeModal()">å–æ¶ˆ</button>';
            showModalRaw();
        }

        function goOverseas(index) {
            const locations = [
                { name: 'éæ´²è‚¯å°¼äºš', bonus: 1.5, risk: 0.3, duration: 365 },
                { name: 'ä¸­ä¸œæ²™ç‰¹', bonus: 1.8, risk: 0.2, duration: 180 },
                { name: 'æ‹‰ç¾å·´è¥¿', bonus: 1.3, risk: 0.1, duration: 270 }
            ];
            
            const loc = locations[index];
            closeModal();
            
            gameData.overseasLocation = loc.name;
            advanceDay(loc.duration);
            
            // è®¡ç®—æ”¶ç›Š
            const baseSalary = Math.floor(gameData.salary / 12 * (loc.duration / 30));
            const overseasBonus = Math.floor(baseSalary * (loc.bonus - 1));
            const totalEarnings = baseSalary + overseasBonus;
            
            gameData.money += totalEarnings;
            gameData.kpi += Math.floor(loc.duration * 2);
            gameData.stats.overseasDays += loc.duration;
            
            // éšæœºäº‹ä»¶
            if (Math.random() < loc.risk) {
                showModal('ğŸ˜°', 'æµ·å¤–é‡é™©', 'åœ¨æµ·å¤–é‡åˆ°çªå‘çŠ¶å†µï¼Œä½†æœ€ç»ˆåŒ–é™©ä¸ºå¤·\nKPIé¢å¤– +300');
                gameData.kpi += 300;
                addAchievement('æ¶‰é™©è¿‡å…³');
            } else {
                addAchievement('æµ·å¤–ç»å†');
            }
            
            // é«˜æ¦‚ç‡æ™‹å‡
            if (Math.random() < 0.6) {
                promote();
                showModal('ğŸ‰', 'æµ·å¤–å½’æ¥', `åœ†æ»¡å®Œæˆæµ·å¤–ä»»åŠ¡ï¼\næ”¶å…¥: Â¥${totalEarnings.toLocaleString()}\nå¹¶è·å¾—æ™‹å‡ï¼`);
            } else {
                showModal('ğŸ‰', 'æµ·å¤–å½’æ¥', `åœ†æ»¡å®Œæˆæµ·å¤–ä»»åŠ¡ï¼\næ”¶å…¥: Â¥${totalEarnings.toLocaleString()}`);
            }
            
            gameData.overseasLocation = null;
            updateUI();
            saveGame();
        }

        // ==================== èŒä¸šå‘å±• ====================
        function switchCareerPath() {
            if (gameData.level < 15) {
                showModal('âŒ', 'æ¡ä»¶ä¸è¶³', 'éœ€è¦15çº§ä»¥ä¸Šæ‰èƒ½åˆ‡æ¢èŒä¸šé€šé“');
                return;
            }
            
            const newPath = gameData.careerPath === 'tech' ? 'management' : 'tech';
            const pathName = newPath === 'tech' ? 'æŠ€æœ¯é€šé“' : 'ç®¡ç†é€šé“';
            
            const buttons = `
                <button class="btn btn-primary" onclick="confirmSwitch('${newPath}')">ç¡®è®¤åˆ‡æ¢</button>
                <button class="btn btn-secondary" onclick="closeModal()">å–æ¶ˆ</button>
            `;
            
            showModal('ğŸ”€', 'åˆ‡æ¢èŒä¸šé€šé“', `ç¡®å®šè¦åˆ‡æ¢åˆ°${pathName}å—ï¼Ÿ\n\nè¿™å°†å½±å“æœªæ¥çš„èŒä¸šå‘å±•è·¯å¾„`, buttons);
        }

        function confirmSwitch(newPath) {
            gameData.careerPath = newPath;
            const config = LEVELS[newPath][gameData.level];
            if (config) {
                gameData.levelName = config.name;
                gameData.salary = config.salary;
                gameData.kpiTarget = config.kpiTarget;
            }
            
            addAchievement('èŒä¸šè½¬å‹');
            showModal('âœ…', 'åˆ‡æ¢æˆåŠŸ', `å·²åˆ‡æ¢åˆ°${newPath === 'tech' ? 'æŠ€æœ¯é€šé“' : 'ç®¡ç†é€šé“'}`);
            updateUI();
            saveGame();
        }

        function showPromotionReview() {
            if (gameData.kpi < gameData.kpiTarget * 0.8) {
                showModal('âŒ', 'KPIä¸è¶³', `å½“å‰KPI: ${gameData.kpi}\néœ€è¦è‡³å°‘: ${Math.floor(gameData.kpiTarget * 0.8)}\n\nå»ºè®®å…ˆå®Œæˆæ›´å¤šå·¥ä½œ`);
                return;
            }
            
            showModal('ğŸ¤', 'å‡†å¤‡è¿°èŒç­”è¾©', 'å³å°†è¿›å…¥è¿°èŒç­”è¾©ç¯èŠ‚\n\næˆåŠŸé€šè¿‡å¯è·å¾—æ™‹å‡æœºä¼šï¼', 
                '<button class="btn btn-primary" onclick="startQTEGame()">å¼€å§‹ç­”è¾©</button><button class="btn btn-secondary" onclick="closeModal()">å–æ¶ˆ</button>');
        }

        function startQTEGame() {
            let score = 0;
            let clicks = 0;
            const maxClicks = 10;
            
            const html = `
                <div class="qte-game">
                    <div class="modal-title">è¿°èŒç­”è¾©</div>
                    <div class="qte-timer">å‰©ä½™: <span id="qte-clicks">${maxClicks}</span> æ¬¡</div>
                    <div style="margin: 20px 0;">ç‚¹å‡»æŒ‰é’®å›ç­”è¯„å§”é—®é¢˜ï¼</div>
                    <button class="qte-button" style="background: #e60012;" onclick="qteClick()">ğŸ’¡</button>
                    <div style="margin-top: 20px; font-size: 18px; font-weight: bold;">å¾—åˆ†: <span id="qte-score">0</span></div>
                </div>
            `;
            
            document.getElementById('modal-description').innerHTML = html;
            document.getElementById('modal-icon').textContent = 'ğŸ¤';
            document.getElementById('modal-buttons').innerHTML = '';
            
            window.qteClick = function() {
                clicks++;
                score += Math.floor(Math.random() * 10 + 5);
                document.getElementById('qte-score').textContent = score;
                document.getElementById('qte-clicks').textContent = maxClicks - clicks;
                
                if (clicks >= maxClicks) {
                    endQTE(score);
                }
            };
        }

        function endQTE(score) {
            delete window.qteClick;
            
            const passScore = 60 + gameData.skills.communication * 5;
            
            if (score >= passScore) {
                promote();
                showModal('ğŸ‰', 'ç­”è¾©æˆåŠŸï¼', `å¾—åˆ†: ${score}\nè¯„å§”ä¼šä¸€è‡´é€šè¿‡ï¼\næ­å–œæ™‹å‡ï¼`);
            } else {
                showModal('ğŸ˜”', 'ç­”è¾©å¤±è´¥', `å¾—åˆ†: ${score}\néœ€è¦: ${Math.floor(passScore)}\n\nå»ºè®®æå‡æ²Ÿé€šèƒ½åŠ›åå†è¯•`);
            }
            
            updateUI();
            saveGame();
        }

        function showJobHopping() {
            if (gameData.level < 15) {
                showModal('ğŸ’¼', 'æš‚æ— è·³æ§½æœºä¼š', 'æå‡åˆ°15çº§åä¼šæœ‰çŒå¤´è”ç³»ä½ ');
                return;
            }
            
            const companies = [
                { name: 'è…¾è®¯', salary: gameData.salary * 1.3, stock: 1000, bonus: 50000 },
                { name: 'é˜¿é‡Œå·´å·´', salary: gameData.salary * 1.4, stock: 800, bonus: 80000 },
                { name: 'å­—èŠ‚è·³åŠ¨', salary: gameData.salary * 1.5, stock: 500, bonus: 100000 }
            ];
            
            let html = '<div class="modal-title">è·³æ§½æœºä¼š</div>';
            companies.forEach((c, i) => {
                html += `
                    <div class="choice-btn" onclick="considerOffer(${i})">
                        <div style="font-weight: bold; margin-bottom: 5px;">ğŸ’¼ ${c.name}</div>
                        <div style="font-size: 12px; color: #666;">
                            å¹´è–ª: Â¥${c.salary.toLocaleString()} | è‚¡ç¥¨: ${c.stock}è‚¡ | ç­¾å­—è´¹: Â¥${c.bonus.toLocaleString()}
                        </div>
                    </div>
                `;
            });
            html += '<div style="margin-top: 15px; color: #999; font-size: 12px; text-align: center;">è·³æ§½å°†é‡ç½®å½“å‰è¿›åº¦</div>';
            
            document.getElementById('modal-description').innerHTML = html;
            document.getElementById('modal-icon').textContent = 'ğŸ’¼';
            document.getElementById('modal-buttons').innerHTML = '<button class="btn btn-secondary" onclick="closeModal()">ç»§ç»­ç•™åœ¨åä¸º</button>';
            showModalRaw();
        }

        function considerOffer(index) {
            const companies = [
                { name: 'è…¾è®¯', salary: gameData.salary * 1.3, stock: 1000, bonus: 50000 },
                { name: 'é˜¿é‡Œå·´å·´', salary: gameData.salary * 1.4, stock: 800, bonus: 80000 },
                { name: 'å­—èŠ‚è·³åŠ¨', salary: gameData.salary * 1.5, stock: 500, bonus: 100000 }
            ];
            
            const company = companies[index];
            
            showModal('ğŸ¤”', 'é‡è¦å†³å®š', 
                `æ¥å—${company.name}çš„offerï¼Ÿ\n\nä½ å°†è·å¾—:\n- å¹´è–ª: Â¥${company.salary.toLocaleString()}\n- è‚¡ç¥¨: ${company.stock}è‚¡\n- ç­¾å­—è´¹: Â¥${company.bonus.toLocaleString()}\n\nä½†ä¼šå¤±å»å½“å‰åä¸ºçš„æ‰€æœ‰ç§¯ç´¯`,
                `<button class="btn btn-primary" onclick="acceptOffer(${index})">æ¥å—offer</button>
                 <button class="btn btn-secondary" onclick="closeModal()">æ‹’ç»</button>`
            );
        }

        function acceptOffer(index) {
            const companies = [
                { name: 'è…¾è®¯', salary: gameData.salary * 1.3, stock: 1000, bonus: 50000 },
                { name: 'é˜¿é‡Œå·´å·´', salary: gameData.salary * 1.4, stock: 800, bonus: 80000 },
                { name: 'å­—èŠ‚è·³åŠ¨', salary: gameData.salary * 1.5, stock: 500, bonus: 100000 }
            ];
            
            const company = companies[index];
            
            gameData.money += company.bonus;
            gameData.salary = company.salary;
            addAchievement(`è·³æ§½åˆ°${company.name}`);
            
            showModal('ğŸŠ', 'æ–°çš„å¼€å§‹', `ä½ åŠ å…¥äº†${company.name}ï¼\n\næ”¶åˆ°ç­¾å­—è´¹: Â¥${company.bonus.toLocaleString()}\næ–°å¹´è–ª: Â¥${company.salary.toLocaleString()}\n\næ¸¸æˆç»“æŸ - æ„Ÿè°¢æ¸¸ç©ï¼`);
            
            updateUI();
            saveGame();
        }

        // ==================== ä¹°è½¦ç³»ç»Ÿ ====================
        function buyCar(type) {
            const cars = {
                porsche: { 
                    name: 'ä¿æ—¶æ·911', 
                    price: 1500000, 
                    levelRequired: 16,
                    discount: 1.0 
                },
                wenjie: { 
                    name: 'åä¸ºé—®ç•ŒM9', 
                    price: 500000, 
                    levelRequired: 0,
                    discount: 0.85  // åä¸ºå‘˜å·¥15%æŠ˜æ‰£
                },
                aito: { 
                    name: 'AITOé—®ç•ŒM7', 
                    price: 300000, 
                    levelRequired: 0,
                    discount: 0.85
                }
            };
            
            if (gameData.cars[type]) {
                showModal('â„¹ï¸', 'å·²æ‹¥æœ‰', `ä½ å·²ç»æ‹¥æœ‰${cars[type].name}äº†`);
                return;
            }
            
            const car = cars[type];
            const actualPrice = Math.floor(car.price * car.discount);
            
            // æ£€æŸ¥èŒçº§
            if (car.levelRequired > 0 && gameData.level < car.levelRequired) {
                showModal('ğŸ”’', 'èŒçº§ä¸è¶³', `è´­ä¹°${car.name}éœ€è¦${car.levelRequired}çº§ä»¥ä¸Š\nå½“å‰èŒçº§: ${gameData.level}çº§`);
                return;
            }
            
            if (gameData.money < actualPrice) {
                showModal('âŒ', 'ä½™é¢ä¸è¶³', `éœ€è¦: Â¥${actualPrice.toLocaleString()}\nå½“å‰å­˜æ¬¾: Â¥${gameData.money.toLocaleString()}`);
                return;
            }
            
            const buttons = `
                <button class="btn btn-primary" onclick="confirmBuyCar('${type}')">ç¡®è®¤è´­ä¹°</button>
                <button class="btn btn-secondary" onclick="closeModal()">å–æ¶ˆ</button>
            `;
            
            let description = `${car.name}\nå”®ä»·: Â¥${actualPrice.toLocaleString()}`;
            
            if (car.discount < 1.0) {
                description += `\nğŸ åä¸ºå‘˜å·¥ä¼˜æƒ : ${Math.floor((1 - car.discount) * 100)}% OFF`;
                description += `\nåŸä»·: Â¥${car.price.toLocaleString()}`;
            }
            
            if (type === 'porsche') {
                description += '\n\nğŸï¸ ä¿æ—¶æ·911ï¼ŒæˆåŠŸäººå£«çš„æ ‡é…\nè´­ä¹°åè§£é”"è±ªè½¦ä¸€æ—"æˆå°±ï¼';
            } else if (type === 'wenjie') {
                description += '\n\nğŸš™ åä¸ºé—®ç•ŒM9ï¼Œé¸¿è’™æ™ºèƒ½åº§èˆ±\næ”¯æŒå›½äº§ï¼è§£é”"åä¸ºå…¨å®¶æ¡¶"æˆå°±ï¼';
            } else {
                description += '\n\nğŸš— é—®ç•ŒM7ï¼Œæ€§ä»·æ¯”ä¹‹é€‰\nè§£é”"æœ‰è½¦ä¸€æ—"æˆå°±ï¼';
            }
            
            showModal('ğŸš—', `è´­ä¹°${car.name}`, description, buttons);
        }

        function confirmBuyCar(type) {
            const cars = {
                porsche: { name: 'ä¿æ—¶æ·911', price: 1500000, discount: 1.0 },
                wenjie: { name: 'åä¸ºé—®ç•ŒM9', price: 500000, discount: 0.85 },
                aito: { name: 'AITOé—®ç•ŒM7', price: 300000, discount: 0.85 }
            };
            
            const car = cars[type];
            const actualPrice = Math.floor(car.price * car.discount);
            
            gameData.money -= actualPrice;
            gameData.cars[type] = true;
            
            addAchievement(`è´­è½¦-${car.name}`);
            
            if (type === 'porsche') {
                addAchievement('è±ªè½¦ä¸€æ—');
            } else if (type === 'wenjie' || type === 'aito') {
                addAchievement('æ”¯æŒå›½äº§');
                // æ£€æŸ¥æ˜¯å¦æœ‰åä¸ºå…¨å®¶æ¡¶
                if (gameData.cars.wenjie && gameData.cars.aito) {
                    addAchievement('åä¸ºå…¨å®¶æ¡¶');
                }
            }
            
            if (Object.values(gameData.cars).filter(Boolean).length >= 2) {
                addAchievement('è½¦åº“æ”¶è—å®¶');
            }
            
            showModal('ğŸ‰', 'è´­è½¦æˆåŠŸ', `æ­å–œè´­ä¹°${car.name}ï¼\næ”¯ä»˜: Â¥${actualPrice.toLocaleString()}`);
            
            updateCarStatus();
            updateUI();
            saveGame();
        }

        function updateCarStatus() {
            document.getElementById('porsche-owned').innerHTML = gameData.cars.porsche ? '<span class="property-owned">å·²æ‹¥æœ‰</span>' : '';
            document.getElementById('wenjie-owned').innerHTML = gameData.cars.wenjie ? '<span class="property-owned">å·²æ‹¥æœ‰</span>' : '';
            document.getElementById('aito-owned').innerHTML = gameData.cars.aito ? '<span class="property-owned">å·²æ‹¥æœ‰</span>' : '';
            
            const carNames = [];
            if (gameData.cars.porsche) carNames.push('ä¿æ—¶æ·911');
            if (gameData.cars.wenjie) carNames.push('é—®ç•ŒM9');
            if (gameData.cars.aito) carNames.push('é—®ç•ŒM7');
            
            document.getElementById('car-status').textContent = carNames.length > 0 ? carNames.join(' + ') : 'æ— è½¦';
        }

        // ==================== ç”Ÿæ´»ç³»ç»Ÿ ====================
        function buyHouse(type) {
            const houses = {
                shenzhenwan: { name: 'æ·±åœ³æ¹¾è±ªå®…å¤§å¹³å±‚', price: 25000000, mortgage: 78000, levelRequired: 18 },
                shenzhen: { name: 'æ·±åœ³å—å±±åŒº', price: 8000000, mortgage: 25000, levelRequired: 0 },
                dongguan: { name: 'ä¸œèæ¾å±±æ¹–', price: 3000000, mortgage: 9500, levelRequired: 0 },
                hometown: { name: 'è€å®¶å¿åŸ', price: 500000, mortgage: 0, levelRequired: 0 }
            };
            
            if (gameData.houses[type]) {
                showModal('â„¹ï¸', 'å·²æ‹¥æœ‰', `ä½ å·²ç»æ‹¥æœ‰${houses[type].name}çš„æˆ¿äº§äº†`);
                return;
            }
            
            const house = houses[type];
            
            // æ£€æŸ¥èŒçº§è¦æ±‚ï¼ˆæ·±åœ³æ¹¾éœ€è¦18çº§ä»¥ä¸Šï¼‰
            if (house.levelRequired > 0 && gameData.level < house.levelRequired) {
                showModal('ğŸ”’', 'èŒçº§ä¸è¶³', `è´­ä¹°${house.name}éœ€è¦${house.levelRequired}çº§ä»¥ä¸Š\nå½“å‰èŒçº§: ${gameData.level}çº§\n\nè¿™æ˜¯é¡¶çº§å¯ŒäººåŒºï¼Œåªæœ‰Fellowçº§åˆ«æ‰èƒ½å…¥ä½ï¼`);
                return;
            }
            
            if (gameData.money < house.price * 0.3) {
                showModal('âŒ', 'é¦–ä»˜ä¸è¶³', `éœ€è¦é¦–ä»˜: Â¥${(house.price * 0.3).toLocaleString()}\nå½“å‰å­˜æ¬¾: Â¥${gameData.money.toLocaleString()}`);
                return;
            }
            
            const buttons = `
                <button class="btn btn-primary" onclick="confirmBuyHouse('${type}')">ç¡®è®¤è´­ä¹°</button>
                <button class="btn btn-secondary" onclick="closeModal()">å–æ¶ˆ</button>
            `;
            
            let description = `æ€»ä»·: Â¥${house.price.toLocaleString()}\né¦–ä»˜(30%): Â¥${(house.price * 0.3).toLocaleString()}\n${house.mortgage > 0 ? `æœˆä¾›: Â¥${house.mortgage.toLocaleString()}` : 'å…¨æ¬¾è´­ä¹°'}`;
            
            if (type === 'shenzhenwan') {
                description += '\n\nğŸŒŸ æ·±åœ³é¡¶çº§è±ªå®…ï¼Œ200ã¡æµ·æ™¯å¤§å¹³å±‚\nä¿¯ç°æ·±åœ³æ¹¾ï¼Œå¯ŒäººåŒºè±¡å¾\nè´­ä¹°åè§£é”"äººç”Ÿèµ¢å®¶"æˆå°±ï¼';
            }
            
            showModal('ğŸ ', `è´­ä¹°${house.name}`, description, buttons);
        }

        function confirmBuyHouse(type) {
            const houses = {
                shenzhenwan: { name: 'æ·±åœ³æ¹¾è±ªå®…å¤§å¹³å±‚', price: 25000000, mortgage: 78000, levelRequired: 18 },
                shenzhen: { name: 'æ·±åœ³å—å±±åŒº', price: 8000000, mortgage: 25000, levelRequired: 0 },
                dongguan: { name: 'ä¸œèæ¾å±±æ¹–', price: 3000000, mortgage: 9500, levelRequired: 0 },
                hometown: { name: 'è€å®¶å¿åŸ', price: 500000, mortgage: 0, levelRequired: 0 }
            };
            
            const house = houses[type];
            const downPayment = type === 'hometown' ? house.price : house.price * 0.3;
            
            gameData.money -= downPayment;
            gameData.houses[type] = true;
            
            addAchievement(`ä¹°æˆ¿-${house.name}`);
            
            // ç‰¹æ®Šæˆå°±
            if (type === 'shenzhenwan') {
                addAchievement('äººç”Ÿèµ¢å®¶');
                addAchievement('æ·±åœ³æ¹¾ä¸šä¸»');
            }
            
            if (Object.values(gameData.houses).filter(Boolean).length === 4) {
                addAchievement('æˆ¿äº§å¤§äº¨Plus');
            } else if (Object.values(gameData.houses).filter(Boolean).length === 3) {
                addAchievement('æˆ¿äº§å¤§äº¨');
            }
            
            let congratsMsg = `æ­å–œè´­ä¹°${house.name}ï¼\næ”¯ä»˜é¦–ä»˜: Â¥${downPayment.toLocaleString()}`;
            
            if (type === 'shenzhenwan') {
                congratsMsg += '\n\nğŸŠ è§£é”"äººç”Ÿèµ¢å®¶"æˆå°±ï¼\nä½ å·²ç»ç«™åœ¨æ·±åœ³çš„é¡¶ç«¯ï¼';
            }
            
            showModal('ğŸ‰', 'è´­æˆ¿æˆåŠŸ', congratsMsg);
            
            updateHouseStatus();
            updateUI();
            saveGame();
        }

        function updateHouseStatus() {
            document.getElementById('shenzhenwan-owned').innerHTML = gameData.houses.shenzhenwan ? '<span class="property-owned">å·²æ‹¥æœ‰</span>' : '';
            document.getElementById('shenzhen-owned').innerHTML = gameData.houses.shenzhen ? '<span class="property-owned">å·²æ‹¥æœ‰</span>' : '';
            document.getElementById('dongguan-owned').innerHTML = gameData.houses.dongguan ? '<span class="property-owned">å·²æ‹¥æœ‰</span>' : '';
            document.getElementById('hometown-owned').innerHTML = gameData.houses.hometown ? '<span class="property-owned">å·²æ‹¥æœ‰</span>' : '';
            
            const houseCount = Object.values(gameData.houses).filter(Boolean).length;
            let houseStatusText = 'æ— æˆ¿äº§';
            
            if (houseCount > 0) {
                const houseNames = [];
                if (gameData.houses.shenzhenwan) houseNames.push('æ·±åœ³æ¹¾è±ªå®…');
                if (gameData.houses.shenzhen) houseNames.push('å—å±±');
                if (gameData.houses.dongguan) houseNames.push('ä¸œè');
                if (gameData.houses.hometown) houseNames.push('è€å®¶');
                
                houseStatusText = houseNames.join(' + ');
            }
            
            document.getElementById('house-status').textContent = houseStatusText;
        }

        function findPartner(type) {
            if (gameData.married) {
                showModal('ğŸ’‘', 'å·²å©š', 'ä½ å·²ç»ç»“å©šäº†ï¼');
                return;
            }
            
            const partners = {
                internal: { 
                    name: 'åä¸ºåŒäº‹', 
                    effect: 'å·¥ä½œæ•ˆç‡+10%',
                    buff: 1.1
                },
                external: { 
                    name: 'å¤–éƒ¨æ‹äºº', 
                    effect: 'ç”Ÿæ´»å¹³è¡¡',
                    buff: 1.0
                }
            };
            
            const partner = partners[type];
            
            const buttons = `
                <button class="btn btn-primary" onclick="confirmMarriage('${type}')">ç¡®å®š</button>
                <button class="btn btn-secondary" onclick="closeModal()">å–æ¶ˆ</button>
            `;
            
            showModal('ğŸ’‘', 'ç»“å©š', `å¯¹è±¡: ${partner.name}\næ•ˆæœ: ${partner.effect}\n\nç¡®å®šè¦ç»“å©šå—ï¼Ÿ`, buttons);
        }

        function confirmMarriage(type) {
            gameData.married = true;
            gameData.marriageType = type;
            
            const partners = {
                internal: 'åä¸ºåŒäº‹',
                external: 'å¤–éƒ¨æ‹äºº'
            };
            
            addAchievement(`ç»“å©š-${partners[type]}`);
            
            showModal('ğŸ’‘', 'æ–°å©šå¿«ä¹', `æ­å–œä½ å’Œ${partners[type]}ç»“å©šäº†ï¼\n\nå¼€å¯äººç”Ÿæ–°ç¯‡ç« ï¼`);
            
            document.getElementById('marriage-status').textContent = partners[type];
            updateUI();
            saveGame();
        }

        // ==================== ä¹°è½¦ç³»ç»Ÿ ====================
        function buyCar(type) {
            const cars = {
                porsche: { name: 'ä¿æ—¶æ·911', price: 1500000, levelRequired: 16 },
                wenjie: { name: 'åä¸ºé—®ç•ŒM9', price: 500000, levelRequired: 0, discount: 0.9 },
                aito: { name: 'AITOé—®ç•ŒM7', price: 300000, levelRequired: 0, discount: 0.85 }
            };
            
            if (gameData.cars[type]) {
                showModal('â„¹ï¸', 'å·²æ‹¥æœ‰', `ä½ å·²ç»æ‹¥æœ‰${cars[type].name}äº†`);
                return;
            }
            
            const car = cars[type];
            
            // æ£€æŸ¥èŒçº§è¦æ±‚
            if (car.levelRequired > 0 && gameData.level < car.levelRequired) {
                showModal('ğŸ”’', 'èŒçº§ä¸è¶³', `è´­ä¹°${car.name}éœ€è¦${car.levelRequired}çº§ä»¥ä¸Š\nå½“å‰èŒçº§: ${gameData.level}çº§`);
                return;
            }
            
            // åä¸ºå‘˜å·¥æŠ˜æ‰£
            let finalPrice = car.price;
            if (car.discount) {
                finalPrice = Math.floor(car.price * car.discount);
            }
            
            if (gameData.money < finalPrice) {
                showModal('âŒ', 'ä½™é¢ä¸è¶³', `è´­ä¹°${car.name}éœ€è¦: Â¥${finalPrice.toLocaleString()}\nå½“å‰å­˜æ¬¾: Â¥${gameData.money.toLocaleString()}`);
                return;
            }
            
            const buttons = `
                <button class="btn btn-primary" onclick="confirmBuyCar('${type}')">ç¡®è®¤è´­ä¹°</button>
                <button class="btn btn-secondary" onclick="closeModal()">å–æ¶ˆ</button>
            `;
            
            let description = `å”®ä»·: Â¥${car.price.toLocaleString()}`;
            if (car.discount) {
                const discount = Math.floor((1 - car.discount) * 100);
                description += `\nåä¸ºå‘˜å·¥${discount}æŠ˜: Â¥${finalPrice.toLocaleString()}`;
            }
            
            if (type === 'porsche') {
                description += '\n\nğŸï¸ ç»å…¸è·‘è½¦ï¼Œå½°æ˜¾æˆåŠŸ\n0-100km/h ä»…éœ€3.0ç§’ï¼';
            } else if (type === 'wenjie') {
                description += '\n\nğŸš™ æ­è½½é¸¿è’™åº§èˆ±ï¼Œæ™ºèƒ½é©¾é©¶\nåä¸ºå‘˜å·¥ä¸“å±ä¼˜æƒ ï¼';
            } else if (type === 'aito') {
                description += '\n\nğŸš— æ€§ä»·æ¯”ä¹‹é€‰ï¼Œæ™ºèƒ½åŒ–é…ç½®\næ–°äººæœ€ä½³é€‰æ‹©ï¼';
            }
            
            showModal('ğŸš—', `è´­ä¹°${car.name}`, description, buttons);
        }

        function confirmBuyCar(type) {
            const cars = {
                porsche: { name: 'ä¿æ—¶æ·911', price: 1500000, levelRequired: 16 },
                wenjie: { name: 'åä¸ºé—®ç•ŒM9', price: 500000, levelRequired: 0, discount: 0.9 },
                aito: { name: 'AITOé—®ç•ŒM7', price: 300000, levelRequired: 0, discount: 0.85 }
            };
            
            const car = cars[type];
            let finalPrice = car.price;
            if (car.discount) {
                finalPrice = Math.floor(car.price * car.discount);
            }
            
            gameData.money -= finalPrice;
            gameData.cars[type] = true;
            
            addAchievement(`è´­è½¦-${car.name}`);
            
            // ç‰¹æ®Šæˆå°±
            if (type === 'porsche') {
                addAchievement('äººç”Ÿèµ¢å®¶-åº§é©¾');
            }
            
            const carsOwned = Object.values(gameData.cars).filter(Boolean).length;
            if (carsOwned === 3) {
                addAchievement('è½¦åº“å¤§äº¨');
            }
            
            let congratsMsg = `æ­å–œè´­ä¹°${car.name}ï¼\næ”¯ä»˜: Â¥${finalPrice.toLocaleString()}`;
            
            if (car.discount) {
                const saved = car.price - finalPrice;
                congratsMsg += `\nèŠ‚çœ: Â¥${saved.toLocaleString()}`;
            }
            
            showModal('ğŸ‰', 'è´­è½¦æˆåŠŸ', congratsMsg);
            
            updateCarStatus();
            updateUI();
            saveGame();
        }

        function updateCarStatus() {
            document.getElementById('porsche-owned').innerHTML = gameData.cars.porsche ? '<span class="property-owned">å·²æ‹¥æœ‰</span>' : '';
            document.getElementById('wenjie-owned').innerHTML = gameData.cars.wenjie ? '<span class="property-owned">å·²æ‹¥æœ‰</span>' : '';
            document.getElementById('aito-owned').innerHTML = gameData.cars.aito ? '<span class="property-owned">å·²æ‹¥æœ‰</span>' : '';
            
            const carCount = Object.values(gameData.cars).filter(Boolean).length;
            let carStatusText = 'æ— è½¦';
            
            if (carCount > 0) {
                const carNames = [];
                if (gameData.cars.porsche) carNames.push('ä¿æ—¶æ·');
                if (gameData.cars.wenjie) carNames.push('é—®ç•ŒM9');
                if (gameData.cars.aito) carNames.push('é—®ç•ŒM7');
                
                carStatusText = carNames.join(' + ');
            }
            
            document.getElementById('car-status').textContent = carStatusText;
        }

        // ==================== è‚¡ç¥¨ç³»ç»Ÿ ====================
        function updateStock() {
            // éšæœºè‚¡ä»·æ³¢åŠ¨
            const change = (Math.random() - 0.48) * 10;
            gameData.stockPrice = Math.max(50, Math.min(300, gameData.stockPrice + change));
            gameData.stockHistory.push(gameData.stockPrice);
            
            // åªä¿ç•™æœ€è¿‘100ä¸ªæ•°æ®ç‚¹
            if (gameData.stockHistory.length > 100) {
                gameData.stockHistory.shift();
            }
            
            document.getElementById('current-stock-price').textContent = `Â¥${Math.floor(gameData.stockPrice)}`;
            document.getElementById('stock-value').textContent = `Â¥${Math.floor(gameData.stock * gameData.stockPrice).toLocaleString()}`;
            
            drawStockChart();
        }

        function drawStockChart() {
            const canvas = document.getElementById('stock-canvas');
            if (!canvas) return;
            
            const ctx = canvas.getContext('2d');
            const width = canvas.width;
            const height = canvas.height;
            
            ctx.clearRect(0, 0, width, height);
            
            if (gameData.stockHistory.length < 2) return;
            
            // è®¡ç®—æ¯”ä¾‹
            const max = Math.max(...gameData.stockHistory);
            const min = Math.min(...gameData.stockHistory);
            const range = max - min || 1;
            
            // ç»˜åˆ¶çº¿æ¡
            ctx.beginPath();
            ctx.strokeStyle = '#e60012';
            ctx.lineWidth = 2;
            
            gameData.stockHistory.forEach((price, i) => {
                const x = (i / (gameData.stockHistory.length - 1)) * (width - 40) + 20;
                const y = height - 20 - ((price - min) / range) * (height - 40);
                
                if (i === 0) {
                    ctx.moveTo(x, y);
                } else {
                    ctx.lineTo(x, y);
                }
            });
            
            ctx.stroke();
            
            // ç»˜åˆ¶å¡«å……
            ctx.lineTo(width - 20, height - 20);
            ctx.lineTo(20, height - 20);
            ctx.closePath();
            ctx.fillStyle = 'rgba(230, 0, 18, 0.1)';
            ctx.fill();
        }

        function buyStock() {
            const stockAmount = 10000; // 1ä¸‡è‚¡
            const cost = gameData.stockPrice * stockAmount;
            
            if (gameData.money < cost) {
                showModal('âŒ', 'ä½™é¢ä¸è¶³', `è´­ä¹°1ä¸‡è‚¡éœ€è¦: Â¥${Math.floor(cost).toLocaleString()}`);
                return;
            }
            
            gameData.money -= cost;
            gameData.stock += 1; // stockå­—æ®µä»¥ä¸‡è‚¡ä¸ºå•ä½
            
            showModal('âœ…', 'è´­ä¹°æˆåŠŸ', `ä»¥Â¥${Math.floor(gameData.stockPrice)}/è‚¡çš„ä»·æ ¼è´­ä¹°äº†1ä¸‡è‚¡\nèŠ±è´¹: Â¥${Math.floor(cost).toLocaleString()}`);
            updateUI();
            saveGame();
        }

        function sellStock() {
            if (gameData.stock < 1) {
                showModal('âŒ', 'è‚¡ç¥¨ä¸è¶³', 'ä½ æ²¡æœ‰è¶³å¤Ÿçš„è‚¡ç¥¨å‡ºå”®ï¼ˆéœ€è¦è‡³å°‘1ä¸‡è‚¡ï¼‰');
                return;
            }
            
            const stockAmount = 10000; // 1ä¸‡è‚¡
            const earnings = gameData.stockPrice * stockAmount;
            gameData.money += earnings;
            gameData.stock -= 1; // stockå­—æ®µä»¥ä¸‡è‚¡ä¸ºå•ä½
            
            showModal('âœ…', 'å–å‡ºæˆåŠŸ', `ä»¥Â¥${Math.floor(gameData.stockPrice)}/è‚¡çš„ä»·æ ¼å–å‡ºäº†1ä¸‡è‚¡\nè·å¾—: Â¥${Math.floor(earnings).toLocaleString()}`);
            updateUI();
            saveGame();
        }

        // ==================== é€šç”¨åŠŸèƒ½ ====================
        function advanceDay(days) {
            gameData.days += days;
            gameData.daysUntilReview -= days;

            // æœˆä¾›æ‰£æ¬¾
            const monthsPassed = Math.floor(gameData.days / 30) - Math.floor((gameData.days - days) / 30);
            if (monthsPassed > 0) {
                // å·¥èµ„
                const monthlySalary = Math.floor(gameData.salary / 12);
                let actualSalary = monthlySalary;
                
                // å†…éƒ¨ç»“å©šåŠ æˆ
                if (gameData.married && gameData.marriageType === 'internal') {
                    actualSalary = Math.floor(monthlySalary * 1.1);
                }
                
                gameData.money += actualSalary;
                
                // æˆ¿è´·
                let mortgage = 0;
                if (gameData.houses.shenzhenwan) mortgage += 78000;
                if (gameData.houses.shenzhen) mortgage += 25000;
                if (gameData.houses.dongguan) mortgage += 9500;
                gameData.money -= mortgage;
            }

            // å¹´åº¦è€ƒæ ¸
            if (gameData.daysUntilReview <= 0) {
                yearlyReview();
            }
        }

        function yearlyReview() {
            gameData.daysUntilReview = 365;
            
            if (gameData.kpi >= gameData.kpiTarget * 1.5) {
                // è¶…é¢å®Œæˆ150%
                gameData.performance = 'A+';
                showModal('ğŸ†', 'å¹´åº¦è€ƒæ ¸: A+', 'å“è¶Šï¼ç»©æ•ˆè¯„çº§A+ï¼Œç›´æ¥æ™‹å‡ï¼');
                promote();
                addAchievement('å¹´åº¦A+');
            } else if (gameData.kpi >= gameData.kpiTarget * 1.2) {
                // è¶…é¢å®Œæˆ120%
                gameData.performance = 'A';
                showModal('ğŸ†', 'å¹´åº¦è€ƒæ ¸: A', 'ä¼˜ç§€ï¼ç»©æ•ˆè¯„çº§Aï¼Œè·å¾—æ™‹å‡');
                promote();
            } else if (gameData.kpi >= gameData.kpiTarget) {
                // å®Œæˆç›®æ ‡
                gameData.performance = 'B+';
                showModal('ğŸ‘', 'å¹´åº¦è€ƒæ ¸: B+', 'è‰¯å¥½ï¼è¾¾æˆç›®æ ‡');
                if (Math.random() < 0.4) promote();
            } else if (gameData.kpi >= gameData.kpiTarget * 0.8) {
                // å®Œæˆ80%
                gameData.performance = 'B';
                showModal('ğŸ˜', 'å¹´åº¦è€ƒæ ¸: B', 'ä¸­ç­‰ã€‚éœ€è¦æ›´åŠ åŠªåŠ›');
                if (Math.random() < 0.1) promote();
            } else if (gameData.kpi >= gameData.kpiTarget * 0.5) {
                // å®Œæˆ50-80%
                gameData.performance = 'B-';
                showModal('ğŸ˜Ÿ', 'å¹´åº¦è€ƒæ ¸: B-', 'ä¸ä½³ã€‚éœ€è¦æ˜æ˜¾æ”¹è¿›');
            } else {
                // ä½äº50%ï¼Œé‡å¤§å¤±è¯¯
                gameData.performance = 'C';
                showModal('ğŸ˜°', 'å¹´åº¦è€ƒæ ¸: C', 'âš ï¸ è­¦å‘Šï¼ä¸¥é‡ä¸è¾¾æ ‡ï¼Œå·²è¿›å…¥PIPï¼ˆç»©æ•ˆæ”¹è¿›è®¡åˆ’ï¼‰\n\nå¦‚æœæ˜å¹´å†æ¬¡Cï¼Œå°†é¢ä¸´æ·˜æ±°é£é™©ï¼');
                addAchievement('æ”¶åˆ°è­¦å‘Š');
            }

            gameData.kpi = 0;
        }

        function promote() {
            const maxLevel = gameData.careerPath === 'tech' ? 20 : 22;
            
            if (gameData.level >= maxLevel) {
                showModal('ğŸŠ', 'å·²è¾¾æœ€é«˜èŒçº§', 'æ­å–œï¼');
                return;
            }

            gameData.level++;
            const newLevel = LEVELS[gameData.careerPath][gameData.level];
            
            if (newLevel) {
                gameData.levelName = newLevel.name;
                gameData.salary = newLevel.salary;
                gameData.kpiTarget = newLevel.kpiTarget;
            }
            
            gameData.stats.promotions++;
            addAchievement(`æ™‹å‡åˆ°${gameData.level}çº§`);
            
            showModal('ğŸš€', 'æ™‹å‡æˆåŠŸï¼', `æ­å–œæ™‹å‡åˆ° ${gameData.level}çº§ ${gameData.levelName}\nå¹´è–ªï¼šÂ¥${gameData.salary.toLocaleString()}`);
        }

        function checkRandomEvent(probability) {
            if (Math.random() < probability) {
                const event = EVENTS[Math.floor(Math.random() * EVENTS.length)];
                showModal(event.icon, event.title, event.desc);
                event.effect();
            }
        }

        function addAchievement(name) {
            if (!gameData.achievements.includes(name)) {
                gameData.achievements.push(name);
                updateAchievements();
            }
        }

        function updateAchievements() {
            const list = document.getElementById('achievement-list');
            if (gameData.achievements.length === 0) {
                list.innerHTML = '<div style="color: #999; text-align: center; padding: 20px;">åŠªåŠ›å·¥ä½œï¼Œè§£é”æˆå°±ï¼</div>';
            } else {
                list.innerHTML = gameData.achievements.map(a => 
                    `<span class="achievement-badge">${a}</span>`
                ).join('');
            }
        }

        // ==================== UI ====================
        function switchTab(tabName) {
            // åˆ‡æ¢æ ‡ç­¾æ¿€æ´»çŠ¶æ€
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            event.target.classList.add('active');
            
            // åˆ‡æ¢å†…å®¹
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            document.getElementById(tabName + '-tab').classList.add('active');
        }

        function updateUI() {
            // åŸºç¡€ä¿¡æ¯
            document.getElementById('player-name').textContent = gameData.playerName || 'åŠ è½½ä¸­...';
            document.getElementById('level').textContent = `${gameData.level}çº§ ${gameData.levelName}`;
            document.getElementById('career-path').textContent = gameData.careerPath === 'tech' ? 'æŠ€æœ¯é€šé“' : 'ç®¡ç†é€šé“';
            document.getElementById('salary').textContent = `Â¥${gameData.salary.toLocaleString()}`;
            document.getElementById('performance').textContent = gameData.performance;
            
            // è‚¡ç¥¨ä¿¡æ¯ï¼ˆä»¥ä¸‡è‚¡ä¸ºå•ä½æ˜¾ç¤ºï¼‰
            const totalStockValue = gameData.stock * 10000 * gameData.stockPrice;
            document.getElementById('stock').textContent = `${gameData.stock} ä¸‡è‚¡`;
            document.getElementById('stock-value').textContent = `Â¥${Math.floor(totalStockValue).toLocaleString()}`;
            document.getElementById('stock-amount').textContent = gameData.stock;
            document.getElementById('total-stock-value').textContent = `Â¥${Math.floor(totalStockValue).toLocaleString()}`;
            document.getElementById('buy-cost').textContent = `Â¥${Math.floor(gameData.stockPrice * 10000).toLocaleString()}`;
            
            document.getElementById('money').textContent = `Â¥${Math.floor(gameData.money).toLocaleString()}`;
            document.getElementById('days').textContent = `${Math.floor(gameData.days)} å¤©`;

            // è¿›åº¦æ¡
            const kpiPercent = Math.min(100, (gameData.kpi / gameData.kpiTarget) * 100);
            document.getElementById('kpi-progress').style.width = kpiPercent + '%';
            document.getElementById('kpi-progress').textContent = `${Math.floor(gameData.kpi)} / ${gameData.kpiTarget}`;

            const yearPercent = Math.max(0, (gameData.daysUntilReview / 365) * 100);
            document.getElementById('year-progress').style.width = yearPercent + '%';
            document.getElementById('year-progress').textContent = `${Math.floor(gameData.daysUntilReview)} å¤©`;

            // èŒä¸šä¿¡æ¯
            document.getElementById('current-path').textContent = gameData.careerPath === 'tech' ? 'æŠ€æœ¯é€šé“' : 'ç®¡ç†é€šé“';
            document.getElementById('switch-requirement').textContent = gameData.level >= 15 ? 'å¯ä»¥åˆ‡æ¢é€šé“' : '15çº§ä»¥ä¸Šå¯åˆ‡æ¢';
            document.getElementById('job-offers').textContent = gameData.level >= 15 ? 'æœ‰å…¬å¸å‘ä½ æŠ›å‡ºæ©„æ¦„æ' : 'æš‚æ— offer';

            // ä¸“åˆ©æˆæœ¬
            const patentCost = 20000 + gameData.stats.totalPatents * 5000;
            document.getElementById('patent-cost').textContent = `Â¥${patentCost.toLocaleString()}`;

            // ç»Ÿè®¡
            document.getElementById('stat-total-kpi').textContent = Math.floor(gameData.stats.totalKPI).toLocaleString();
            document.getElementById('stat-total-projects').textContent = gameData.stats.totalProjects;
            document.getElementById('stat-total-patents').textContent = gameData.stats.totalPatents;
            document.getElementById('stat-promotions').textContent = gameData.stats.promotions;

            // æ’è¡Œæ¦œ
            document.getElementById('your-rank-info').textContent = `${gameData.level}çº§ ${gameData.levelName}`;
            document.getElementById('your-rank-days').textContent = `å·¥é¾„: ${Math.floor(gameData.days)}å¤©`;

            // ç”Ÿæ´»
            updateHouseStatus();
            updateCarStatus();
            updatePatentList();
            updateAchievements();
        }

        // ==================== æ¨¡æ€æ¡† ====================
        function showModal(icon, title, description, buttons = null) {
            document.getElementById('modal-icon').textContent = icon;
            document.getElementById('modal-title').textContent = title;
            document.getElementById('modal-description').textContent = description;
            document.getElementById('modal-buttons').innerHTML = buttons || '<button class="btn btn-primary" onclick="closeModal()">ç¡®å®š</button>';
            document.getElementById('modal').classList.add('show');
        }

        function showModalRaw() {
            document.getElementById('modal').classList.add('show');
        }

        function closeModal() {
            document.getElementById('modal').classList.remove('show');
        }

        // ==================== å­˜æ¡£ ====================
        function saveGame() {
            localStorage.setItem('huaweiGameV3', JSON.stringify(gameData));
        }

        function loadGame() {
            const saved = localStorage.getItem('huaweiGameV3');
            if (saved) {
                gameData = JSON.parse(saved);
            }
        }

        function resetGame() {
            if (confirm('ç¡®å®šè¦é‡ç½®æ¸¸æˆå—ï¼Ÿæ‰€æœ‰è¿›åº¦å°†ä¸¢å¤±ï¼')) {
                localStorage.removeItem('huaweiGameV3');
                location.reload();
            }
        }

        // å¯åŠ¨æ¸¸æˆ
        init();
    </script>
</body>
</html>
